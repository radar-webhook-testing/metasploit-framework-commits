<%= Msf::Ui::Web::Common.header(framework.version, 'exploits') %>
<tr><td colspan='5'>

<%
	name   = query_string['name']
	step   = query_string['step'] || 0
	target = query_string['target']

	step = step.to_i

	if (name == nil)
 %>

<%# Display the exploit list if one hasn't been selected %>
<br/>
<div align='center' class='navHead'>
	<table class='moduleList' width='100%' cellspacing='0' border='0'>
		<% framework.exploits.each_module { |name, mod| 
			modinst = mod.new
		 %>
		<tr>
			<td class='moduleIcons' align='center'>
				<%= Msf::Ui::Web::Common.module_icons(modinst) %>
			</td>
			<td class='moduleName'>
				<a href="exploits.rhtml?name=<%= name %>"><%= modinst.name %></a>
			</td>
			<td class='moduleSpacer' colspan='2'>
			</td>
		</tr>
		<% } %>
	</table>
</div>

<%# Wizard step 0 %>
<%
	elsif (step == 0)
		modinst = framework.exploits.create(name)
 %>
<br/>
<table width='100%' cellspacing='0' cellpadding='0' border='0'>
	<tr>
		<td class='moduleName'>
			<div class='textBold'><%= html_escape(modinst.name) %></div>
		</td>
	</tr>
</table>
<br/>

<table align='center' width='95%' cellspacing='0' cellpadding='6' border='0'>
	<tr>
		<td align='right' width='80' class='textBold'>Name:</td>
		<td class='textNormal'><%= html_escape(modinst.name) %></td>
	</tr>
	<tr>
		<td align='right' width='80' class='textBold'>Authors:</td>
		<td class='textNormal'><%= html_escape(modinst.author.join("<br/>")) %></td>
	</tr>
	<tr>
		<td align='right' width='80' class='textBold' valign='top'>Description:</td>
		<td colspan='2' class='textNormal' valign='top'>
			<%= html_escape(modinst.description) %>
		</td>
	</tr>
	<tr>
		<td align='right' width='80' class='textBold' valign='top'>References:</td>
		<td colspan='2' class='textNormal' valign='top'>
			<% modinst.references.each { |ref| %>
					<% if (ref.kind_of?(Msf::Module::SiteReference)) %>
					- <a href='<%= ref.site %>' target='_blank'><%= ref.to_s %></a><br/>
			<% 	else %>
					- <%= ref.to_s %><br/>
			<% 	end %>
			<% } %>
		</td>
	</tr>
	<tr>
		<td align='right' width='80' class='textBold'>Targets:</td>
		<td class='textNormal'>&nbsp;</td>
	<tr>
		<td>&nbsp;</td>
		<td>
			<table align='align' cellpadding='2' cellspacing='0' border='0'>
				<tr>
					<td class='textBold'>Target Name</td>
					<td class='textBold'>Platform</td>
				</tr>
				<% modinst.targets.each_with_index { |tgt, idx| %>
				<tr>
					<td class='textBoldColor<%= (idx % 2 == 0) ? "B" : "A" %>' align='left'>
						<%= idx %> - <a href='exploits.rhtml?name=<%= name %>&step=<%= step + 1 %>&target=<%= idx %>'><%= tgt.name %></a>
					</td>
					<td class='textBoldColor<%= (idx % 2 == 0) ? "B" : "A" %>' align='left'>
						<%= Msf::Ui::Web::Common.target_icons(tgt) %>	
					</td>
				</tr>
				<% } %>
			</table>
		</td>
	</tr>
</table>

<%# Wizard step 1 %>
<%
	elsif (step == 1)
		modinst = framework.exploits.create(name)
		modinst.datastore['TARGET'] = query_string['target'].to_i
 %>
<br/>
<table width='100%' cellspacing='0' cellpadding='0' border='0'>
	<tr>
		<td class='moduleName'>
			<div class='textBold'><%= html_escape(modinst.name) %></div>
		</td>
	</tr>
</table>
<br/>

<table align='center' width='95%' cellspacing='0' cellpadding='6' border='0'>
	<tr>
		<td align='left' width='80' class='textBold'><nobr>Select Payload:</nobr></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td>
		<td class='textBold'>Name</td>
		<td class='textBold'>Description</td>
	</tr>

	<% idx = 0
		modinst.compatible_payloads.each { |pname, pmod| 
			pmodinst = pmod.new
	 %>
		
	<tr>
		<td>&nbsp;</td>
		<td class='textBoldColor<%= (idx % 2 == 0) ? "B" : "A" %>' align='left'>
			<a href='exploits.rhtml?name=<%= name %>&step=<%= step + 1 %>&target=<%= target %>&payload=<%= pname %>'><%= html_escape(pname) %></a>
		</td>
		<td class='textBoldColor<%= (idx % 2 == 0) ? "B" : "A" %>' align='left'><%= html_escape(pmodinst.description) %></td>
	</tr>

	<% idx += 1
		}
	 %>

</table>

<%# Wizard step 2 %>
<% elsif (step == 2)
		modinst = framework.exploits.create(name)
		modinst.datastore['TARGET'] = query_string['target'].to_i
 %>



<% else %>
	Unknown step: <%= html_escape(step) %>
<% end %>

</td></tr>
<%= Msf::Ui::Web::Common.footer %>
